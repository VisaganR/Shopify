{"ast":null,"code":"import{CardElement,useElements,useStripe}from\"@stripe/react-stripe-js\";import React,{useState}from\"react\";import{Alert,Button,Col,Form,Row}from\"react-bootstrap\";import{useSelector}from\"react-redux\";import{useNavigate}from\"react-router-dom\";import{useCreateOrderMutation}from\"../services/appApi\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function CheckoutForm(){const stripe=useStripe();const elements=useElements();const user=useSelector(state=>state.user);const navigate=useNavigate();const[alertMessage,setAlertMessage]=useState(\"\");const[createOrder,{isLoading,isError,isSuccess}]=useCreateOrderMutation();const[country,setCountry]=useState(\"\");const[address,setAddress]=useState(\"\");const[paying,setPaying]=useState(false);async function handlePay(e){e.preventDefault();if(!stripe||!elements||user.cart.count<=0)return;setPaying(true);const{client_secret}=await fetch(\"http://localhost:8080/create-payment\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\",Authorization:\"Bearer \"},body:JSON.stringify({amount:user.cart.total})}).then(res=>res.json());const{paymentIntent}=await stripe.confirmCardPayment(client_secret,{payment_method:{card:elements.getElement(CardElement)}});setPaying(false);if(paymentIntent){createOrder({userId:user._id,cart:user.cart,address,country}).then(res=>{if(!isLoading&&!isError){setAlertMessage(\"Payment \".concat(paymentIntent.status));setTimeout(()=>{// navigate(\"/orders\");\n},3000);}});}}return/*#__PURE__*/_jsx(Col,{className:\"cart-payment-container\",children:/*#__PURE__*/_jsxs(Form,{onSubmit:handlePay,children:[/*#__PURE__*/_jsxs(Row,{children:[alertMessage&&/*#__PURE__*/_jsx(Alert,{children:alertMessage}),/*#__PURE__*/_jsx(Col,{md:6,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"First Name\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",placeholder:\"First Name\",value:user.name,disabled:true})]})}),/*#__PURE__*/_jsx(Col,{md:6,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Email\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",placeholder:\"Email\",value:user.email,disabled:true})]})})]}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:7,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Address\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",placeholder:\"Address\",value:address,onChange:e=>setAddress(e.target.value),required:true})]})}),/*#__PURE__*/_jsx(Col,{md:5,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Country\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",placeholder:\"Country\",value:country,onChange:e=>setCountry(e.target.value),required:true})]})})]}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"card-element\",children:\"Card\"}),/*#__PURE__*/_jsx(CardElement,{id:\"card-element\"}),/*#__PURE__*/_jsx(Button,{className:\"mt-3\",type:\"submit\",disabled:user.cart.count<=0||paying||isSuccess,children:paying?\"Processing...\":\"Pay\"})]})});}export default CheckoutForm;","map":{"version":3,"names":["CardElement","useElements","useStripe","React","useState","Alert","Button","Col","Form","Row","useSelector","useNavigate","useCreateOrderMutation","jsx","_jsx","jsxs","_jsxs","CheckoutForm","stripe","elements","user","state","navigate","alertMessage","setAlertMessage","createOrder","isLoading","isError","isSuccess","country","setCountry","address","setAddress","paying","setPaying","handlePay","e","preventDefault","cart","count","client_secret","fetch","method","headers","Authorization","body","JSON","stringify","amount","total","then","res","json","paymentIntent","confirmCardPayment","payment_method","card","getElement","userId","_id","concat","status","setTimeout","className","children","onSubmit","md","Group","Label","Control","type","placeholder","value","name","disabled","email","onChange","target","required","htmlFor","id"],"sources":["C:/Users/91637/OneDrive/Desktop/E-commerce/frontend/src/components/CheckoutForm.js"],"sourcesContent":["import { CardElement, useElements, useStripe } from \"@stripe/react-stripe-js\";\r\nimport React, { useState } from \"react\";\r\nimport { Alert, Button, Col, Form, Row } from \"react-bootstrap\";\r\nimport { useSelector } from \"react-redux\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { useCreateOrderMutation } from \"../services/appApi\";\r\n\r\nfunction CheckoutForm() {\r\n    const stripe = useStripe();\r\n    const elements = useElements();\r\n    const user = useSelector((state) => state.user);\r\n    const navigate = useNavigate();\r\n    const [alertMessage, setAlertMessage] = useState(\"\");\r\n    const [createOrder, { isLoading, isError, isSuccess }] = useCreateOrderMutation();\r\n    const [country, setCountry] = useState(\"\");\r\n    const [address, setAddress] = useState(\"\");\r\n    const [paying, setPaying] = useState(false);\r\n\r\n    async function handlePay(e) {\r\n        e.preventDefault();\r\n        if (!stripe || !elements || user.cart.count <= 0) return;\r\n        setPaying(true);\r\n        const { client_secret } = await fetch(\"http://localhost:8080/create-payment\", {\r\n            method: \"POST\",\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                Authorization: \"Bearer \",\r\n            },\r\n            body: JSON.stringify({ amount: user.cart.total }),\r\n        }).then((res) => res.json());\r\n        const { paymentIntent } = await stripe.confirmCardPayment(client_secret, {\r\n            payment_method: {\r\n                card: elements.getElement(CardElement),\r\n            },\r\n        });\r\n        setPaying(false);\r\n\r\n        if (paymentIntent) {\r\n            createOrder({ userId: user._id, cart: user.cart, address, country }).then((res) => {\r\n                if (!isLoading && !isError) {\r\n                    setAlertMessage(`Payment ${paymentIntent.status}`);\r\n                    setTimeout(() => {\r\n                        // navigate(\"/orders\");\r\n                    }, 3000);\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    return (\r\n        <Col className=\"cart-payment-container\">\r\n            <Form onSubmit={handlePay}>\r\n                <Row>\r\n                    {alertMessage && <Alert>{alertMessage}</Alert>}\r\n                    <Col md={6}>\r\n                        <Form.Group className=\"mb-3\">\r\n                            <Form.Label>First Name</Form.Label>\r\n                            <Form.Control type=\"text\" placeholder=\"First Name\" value={user.name} disabled />\r\n                        </Form.Group>\r\n                    </Col>\r\n                    <Col md={6}>\r\n                        <Form.Group className=\"mb-3\">\r\n                            <Form.Label>Email</Form.Label>\r\n                            <Form.Control type=\"text\" placeholder=\"Email\" value={user.email} disabled />\r\n                        </Form.Group>\r\n                    </Col>\r\n                </Row>\r\n                <Row>\r\n                    <Col md={7}>\r\n                        <Form.Group className=\"mb-3\">\r\n                            <Form.Label>Address</Form.Label>\r\n                            <Form.Control type=\"text\" placeholder=\"Address\" value={address} onChange={(e) => setAddress(e.target.value)} required />\r\n                        </Form.Group>\r\n                    </Col>\r\n                    <Col md={5}>\r\n                        <Form.Group className=\"mb-3\">\r\n                            <Form.Label>Country</Form.Label>\r\n                            <Form.Control type=\"text\" placeholder=\"Country\" value={country} onChange={(e) => setCountry(e.target.value)} required />\r\n                        </Form.Group>\r\n                    </Col>\r\n                </Row>\r\n                <label htmlFor=\"card-element\">Card</label>\r\n                <CardElement id=\"card-element\" />\r\n                <Button className=\"mt-3\" type=\"submit\" disabled={user.cart.count <= 0 || paying || isSuccess}>\r\n                    {paying ? \"Processing...\" : \"Pay\"}\r\n                </Button>\r\n            </Form>\r\n        </Col>\r\n    );\r\n}\r\n\r\nexport default CheckoutForm;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}